<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.min.js"></script>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,
            shrink-to-fit=no, viewport-fit=cover">
    <meta name="description" content="Gift Checklist">
    <title>Gift checklist</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
</head>



<style>
    h1 {
        text-decoration: underline;
        color: #547DEF;
    }

    h2 {
        color: #547DEF;
        font-size: 20px;
    }

    h3 {
        font-weight: bold;
    }

    body {
        font-family: "Arimo", "Helvetica", sans-serif;
        background-color: #e9e9e6;
    }
  
    input {
      border-radius: 10px;
    }
  
    button {
      border-radius: 2px;
      font-family: "Arimo", "Helvetica", sans-serif;
      font-weight: bold;
      background-color: #E6E6FA;
    }
  
    .the-list .row .parent {
        display: flex;
        gap: 30px;
    }


    .the-list .parent {
        justify-content: flex-start;
    }


    .the-list .box {
        width: 5em;
    }
  
    .min-width {
      display: inline-block;
      min-width: 100px;
    }



    .bnr img {
      float: right;
       width: 8%;
        border-radius: 82px;
        background: #e8e8e1;
        left: 0;
        top: 0;
        margin: 5px;
        z-index: 1;
        position: fixed;
    }

    button {
      font-size: 15px;
      font-family: Arimo;
      width: 70;
      height: 30;
      border-width: 1px;
      color: #fff;
      border-color: rgba(84, 125, 239, 1);
      font-weight: bold;
      border-top-left-radius: 28px;
      border-top-right-radius: 28px;
      border-bottom-left-radius: 28px;
      border-bottom-right-radius: 28px;
      text-shadow: 1px 1px 0px rgb(135 84 239);
      background: rgba(84, 125, 239, 1);
    }

    button:hover {
      background: rgba(0, 0, 0, 1)
}
  
</style>

<body>
  
   <center>
    <section class="bnr">
      <img src="gift.svg" alt="logo">
      <h1 class="page-heading"> Gift Registry </h1>
    </section>

    <section class="login">
        <div class="loginpage">
            <label for="username_field"> User name: </label> 
            <input type="text" name="key_field" id="username_field" required>
            <br>
            <label for="key_field"> Password:</label> 
            <input type="text" name="key_field" id="key_field" required>
            <p>
            <button type="button" id="login">Login</button>
        </div>
    </section>
  </center>

    <section class="the-list">
        <div class="list">

          <center><h2 class="list-heading"> Wish List </h2></center>

            <h3 class="name-section">
                <div class="recipient-name">
                    <label for="fullname"> Recipient Name: </label>
                    <input type="text" name="fullname" class="fullname">
                </div>
            </h3>

            <form class="input list list-fields">
                <div>
                    <label for="list_entry" class="min-width"> Item Name: </label>
                    <input type="text" name="list_entry" id="list_entry">
                </div>
                <div>
                    <label for="url" class="min-width"> Link: </label>
                    <input type="url" name="url" class="url">
                </div>
                <div>
                    <label for="quantity" class="min-width"> Quantity: </label>
                    <input type="number" name="quantity" class="quantity">
                </div>
                <div>
                    <label for="comments" class="min-width"> Comments: </label>
                    <input type="text" name="comments" class="comments">
                </div>
                <div>
                    <button class="addItemButton" type="button">Add</button>
                </div>
            </form>


            <div class="container item-List">
              <label> Wish List Items: </label>
                <div class="row">
                    <div class="parent">
                        <input unchecked type="checkbox" class="checked"> <a
                            href="https://www.amazon.ca/pants">Pants</a>
                        <div class="attribute">
                            1
                        </div>
                        <div class="attribute">
                            Medium, in black
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="parent">
                        <input unchecked type="checkbox" class="checked"> <a
                            href="https://www.amazon.ca/shirt">Shirt </a>
                        <div class="attribute">
                            6
                        </div>
                        <div class="attribute">
                            Small
                        </div>
                    </div>
                </div>
            </div>

            <p>
            <button type="button" class="submit-button">Submit</button>
    </section>

</body>

</html>

<script>
    // ------------ELEMENTS------------
    // Buttons
    const btnlogin = document.querySelector('#login');
    const btnAddItemButton = document.querySelector('.addItemButton');
    const btnSubmitList = document.querySelector('.submit-button');

    // Input Fields
    const recipientNameField = document.querySelector('.fullname');
    const usernameField = document.querySelector('#username_field');
    const passwordField = document.querySelector('#key_field');

    const itemNameField = document.querySelector('#list_entry');
    const itemLinkField = document.querySelector('.url');
    const itemQuantityField = document.querySelector('.quantity');
    const itemCommentsField = document.querySelector('.comments');


    // Page Sections
    const loginPage = document.querySelector('.login');
    const listPage = document.querySelector('.the-list');
    const nameSection = document.querySelector('.name-section');
    //const nameSection = document.querySelector('.name-section');

    const inputListFields = document.querySelector('.list-fields');
    const itemListContainer = document.querySelector('.item-List');


    // Wishlist Item Object
    const item1 = {
        name: "Shirt",
        link: "https://www.amazon.ca/shirt",
        quantity: 1,
        comments: "Medium, in black Test Data",
        checked: false,
    }
    const item2 = {
        name: "Pants",
        link: "https://www.amazon.ca/pants",
        quantity: 6,
        comments: "Small Test Data",
        checked: false,
    }

    // User object
    class User {
        constructor(username, password) {
            this.username = username;
            this.password = password;
            this.listArray = [];
            this.firstTimeLogin = true;
        }
    }

    class Item {
        constructor(itemName, itemLink, itemQuantity, itemComments) {
            this.name = itemName;
            this.link = itemLink;
            this.quantity = itemQuantity;
            this.comments = itemComments;
            this.checked = false;
        }
    }

    const user1 = {
        name: "John Smith",
        username: "jsmith",
        password: 1111,
        eventDate: "January 1st, 2022",
        listArray: [item1, item2],
        firstTimeLogin: false,
    };

    const user2 = {
        name: "Tyler One",
        username: "tone",
        password: 2222,
        eventDate: "January 5th, 2022",
        listArray: [item1],
        firstTimeLogin: false,
    };

    let accounts = [user1, user2];
    let currentAccount;
    let validLogin = false;

    // ------------FUNCTIONS------------
    const createNewAccount = function () {
        const user = new User(usernameField.value, Number(passwordField.value));
        replaceRecipientNameField();
        currentAccount = user;
        // ####################UNCOMMENT THIS FOR HIDING CODE########################
        loginPage.hidden = true;
        listPage.hidden = false;
    };
  
    const isInvalidLogin = function(username, password) {
      if (username == '' || password == '') {
       return true; 
      } else {
       return false; 
      }
    }

    const checkUsername = function () {
        accounts.some(function (acc) {
            if (acc.username === usernameField.value && acc.password === Number(passwordField.value)) {
                // If valid username, change current account
                currentAccount = acc;
                updateUI();
                if (!(currentAccount.firstTimeLogin)) {
                    window.alert(`Welcome to ${currentAccount.name}'s wishlist.  \nPlease check off the items you're going to buy for them`);
                    removeRecipientNameField();
                }
                usernameField.value = passwordField.value = '';
                // ####################UNCOMMENT THIS FOR HIDING CODE########################
                loginPage.hidden = true;
                listPage.hidden = false;
                return true;
            } else if (acc.username === usernameField.value && acc.password != Number(passwordField.value)) {
                window.alert(`Wrong password`);
            } else if (isInvalidLogin(usernameField.value, passwordField.value)) {
                window.alert('Invalid login information');
                return true;
            } else if (currentAccount === null && !(accounts.map(acc => acc.username).includes(usernameField.value))) {
                // If invalid username, call create new account object
                window.alert('User not found, creating a new user');
                createNewAccount();
                updateUI();
                usernameField.value = passwordField.value = '';
              return true;
            }
        });
    };

    const checkFirstTimeLogin = function () {
        if (currentAccount.firstTimeLogin) {
            inputListFields.hidden = false;
        } else {
            inputListFields.hidden = true;
        }
    }

    const removeRecipientNameField = function () {
        nameSection.innerHTML = '';
            const html = `
                    <label for="fullname"> ${currentAccount.name} </label>
`
         nameSection.insertAdjacentHTML("beforeend", html);
    };

    const replaceRecipientNameField = function () {
        nameSection.innerHTML = '';
            const html = `
                <div class="recipient-name">
                    <label for="fullname"> Recipient Name: </label>
                    <input type="text" name="fullname" class="fullname">
                </div>
`
         nameSection.insertAdjacentHTML("beforeend", html);
    };
  
    const populateItems = function () {
        itemListContainer.innerHTML = '';
        currentAccount.listArray.forEach(function (item, i) {
            const html = `
        <div class="row">
            <div class="parent">
                <input unchecked type= "checkbox" class="checked"> <a href="${item.link}">${item.name}</a>
                <div class="attribute">
                    ${item.quantity}
                </div>
                <div class="attribute">
                    ${item.comments}
                </div>
            </div>
        </div>
`
         itemListContainer.insertAdjacentHTML("beforeend", html);
        });
    };

    const validateURL = function (link) {
        if (link.indexOf("http://") == 0 || link.indexOf("https://") == 0) {
            const urlPrefix = "www.";
            return urlPrefix.concat(link);
        } else if (link.indexOf("http://www.") == 0 || link.indexOf("https://www.") == 0) {
            return link;
        }
        else if (link.indexOf("www.") == 0) {
            const urlPrefix = "http://";
            return urlPrefix.concat(link);
        } else {
            return link;
        }
    }

    const updateUI = function () {
        //populate the list items by forEach loop over currentUser 
        populateItems();
        checkBoxUpdate();
    }

    //user1.listArray[1].checked = true; 

    const checkBoxUpdate = function () {
        var checklist = document.getElementsByClassName("checked");
        ///*
        for (var j = 0; j < checklist.length; j++) {
            checklist[j].addEventListener('change', function () {
                if (checklist[j].checked) {
                    document.write("success")
                    //currentAccount.listArray[j].checked = true;
                } else {
                    currentAccount.listArray[j].checked = false;
                }
            });
        }
        //*/
    }

    function isCheckedOff(e) {
        if (e.target.checked) {
            currentAccount.listArray[j].checked = true;
        } else {
            currentAccount.listArray[j].checked = false;
        }
    }

    // ####################UNCOMMENT THIS FOR HIDING CODE########################
    listPage.hidden = true;

    // ------------BUTTONS------------
    btnlogin.addEventListener('click', function () {
        //Clear the current account
        currentAccount = null;
        checkUsername();
        checkFirstTimeLogin();
    });


    btnAddItemButton.addEventListener('click', function () {
        const item = new Item(itemNameField.value, validateURL(itemLinkField.value), Number(itemQuantityField.value), itemCommentsField.value)
        itemNameField.value = itemLinkField.value = itemQuantityField.value = itemCommentsField.value = '';
        currentAccount.listArray.push(item);
        updateUI();
    });

    //btnCheckBox.addEventListener('click', function() {
    //whenever box is checked, change flag in object
    //updateUI
    //});


    btnSubmitList.addEventListener('click', function () {
        if (!(accounts.map(acc => acc.username).includes(currentAccount.username))) {
            const recipientNameField = document.querySelector('.fullname');
            currentAccount.name = recipientNameField.value;
            currentAccount.firstTimeLogin = false;
            accounts.push(currentAccount);
        }
        currentAccount.firstTimeLogin = false;
        recipientNameField.value = "";
        currentAccount = null;
        // ####################UNCOMMENT THIS FOR HIDING CODE########################
        loginPage.hidden = false;
        listPage.hidden = true;
        inputListFields.hidden = true;
    });


</script>




</script>
